# Network Logging Implementation Summary

## Overview

Added comprehensive phase-by-phase logging to track backend analysis operations. All phases now log to `backend/network-log.app` with consistent structured JSON format.

## Files Modified

### backend/app/services/network_logger.py
- Added `log_analyze_functions()` to log the function analysis phase
- Existing functions: `log_clone`, `log_parse`, `log_llm_analyze`, `log_build_graph`, `log_generate_summary`

### backend/app/api/routes.py
- Added `time` and `log_clone` imports
- Added `_get_directory_size()` helper to calculate cloned repo size
- Updated `_run_github_analysis()`:
  - Times the clone operation using `time.perf_counter()`
  - Logs successful clones with duration, repo name, branch, and size
  - Logs failed clones with error message

### backend/app/services/analysis.py
- Added `log_analyze_functions` import
- Added timing and logging for the function analysis phase

## Logging Coverage

| Phase              | Log Function             | Metrics Captured                    |
|--------------------|--------------------------|-------------------------------------|
| Clone              | `log_clone()`            | repo, branch, size_bytes, size_mb   |
| Parse              | `log_parse()`            | file_count                          |
| LLM Analyze        | `log_llm_analyze()`      | file_count, batch_count             |
| Build Graph        | `log_build_graph()`      | node_count, edge_count              |
| Analyze Functions  | `log_analyze_functions()`| function_count, call_count          |
| Generate Summary   | `log_generate_summary()` | (none)                              |

## Log Entry Format

Each log entry is a single-line JSON object:

```json
{
  "timestamp": "2026-01-07T12:34:56.789012+00:00",
  "operation": "clone",
  "duration_seconds": 3.5,
  "success": true,
  "metrics": {
    "repo": "owner/repo",
    "branch": "main",
    "size_bytes": 12345678,
    "size_mb": 11.77
  }
}
```

For failed operations:
```json
{
  "timestamp": "2026-01-07T12:34:56.789012+00:00",
  "operation": "clone",
  "duration_seconds": 1.2,
  "success": false,
  "error": "Failed to clone repository: ..."
}
```

## Purpose

This logging addresses issue #3 from network.md: tracking which phase the backend is in during analysis. The logs provide visibility into:
- How long each phase takes
- Success/failure status of each phase
- Key metrics for debugging and performance analysis

---

# Frontend Network Logging

## Overview

Added frontend logging to track when status updates are received from the backend and how the progress animation responds. This helps identify discrepancies between backend phase transitions and frontend display.

## Files Created/Modified

### frontend/src/utils/networkLogger.ts (NEW)
Centralized frontend logger that mirrors the backend format:
- `logAnalysisStart()` - When analysis begins
- `logStatusPoll()` - When status poll response is received
- `logAnalysisComplete()` - When analysis finishes successfully
- `logAnalysisError()` - When analysis fails
- `logProgressAnimation()` - When animation state changes
- `getLogs()` - Retrieve stored logs from localStorage
- `clearLogs()` - Clear stored logs
- `exportLogs()` - Download logs as JSON file
- `printPhaseSummary()` - Print phase duration summary to console

### frontend/src/hooks/useAnalysis.ts
- Added imports for network logger functions
- Added `logAnalysisStart()` call when analysis begins
- Added `logStatusPoll()` call on every status poll response
- Added `logAnalysisComplete()` call when analysis completes
- Added `logAnalysisError()` call when analysis fails
- Changed polling interval from 3 seconds to 1 second for more responsive updates

### frontend/src/hooks/useProgressAnimation.ts
- Added `logProgressAnimation()` import
- Added logging when animation starts (with current progress, target, and duration)
- Added console logging when animation completes

### frontend/src/types/index.ts
- Added missing `progress` field to `AnalysisStatusResponse` interface

## How to Use

### Viewing Logs
Open browser DevTools console during an analysis. Logs appear with color-coded prefixes:
- `[FE-NET]` (blue) - Status poll events
- `[ANIM]` (pink/green) - Animation events

### Accessing Stored Logs
In browser console:
```javascript
// Get all logs
const logs = JSON.parse(localStorage.getItem('frontend_network_logs'));

// Or use helper functions (import in code)
import { getLogs, exportLogs, printPhaseSummary, clearLogs } from './utils/networkLogger';
getLogs();           // Returns array of log entries
exportLogs();        // Downloads logs as JSON file
printPhaseSummary(); // Prints phase durations to console
clearLogs();         // Clears stored logs
```

## Frontend Log Entry Format

```json
{
  "timestamp": "2026-01-07T12:34:56.789Z",
  "operation": "phase_change",
  "phase": "analyzing",
  "previousPhase": "parsing",
  "progress": 15,
  "currentStep": "AI is analyzing your code...",
  "totalFiles": 42,
  "source": "status_change",
  "timeSinceAnalysisStart": 5.234,
  "timeSinceLastUpdate": 1.002
}
```

## Comparing Backend vs Frontend

To pinpoint discrepancies:
1. Run an analysis with both backend and frontend logging enabled
2. Backend logs: `cat backend/network-log.app`
3. Frontend logs: `localStorage.getItem('frontend_network_logs')` or `exportLogs()`
4. Compare timestamps and phase transitions between the two

Key things to check:
- Time gap between backend phase change and frontend receiving it
- Whether frontend is missing any phase transitions
- Animation duration vs actual phase duration
